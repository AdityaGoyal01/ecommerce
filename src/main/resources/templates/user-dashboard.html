<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<head>
    <meta charset="UTF-8">
    <title>User Dashboard | E-commerce</title>
    <link rel="stylesheet" href="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/css/bootstrap.min.css">

    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color:white;
        }
        /* Header */
        .navbar-custom {
            background:black;
            padding: 12px 25px;
            color:white;
        }


       .navbar-custom .navbar-brand,
       .navbar-custom .nav > li > a {
          color: white!important;
          font-weight: 500;
       }

          /* Keep buttons inside navbar styled normally */
          .navbar-custom .btn {
             color: inherit !important;
             font-weight: 600;

          }
        /* Hero section */
        .hero {
            background: url('/images/store-banner.jpg') center/cover no-repeat;
            height: 300px;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            color: black;
            text-shadow: 1px 1px 4px rgba(0,0,0,0.6);
            margin-bottom: 30px;
            font-family:playfair display;
        }
        .hero h1 {
            font-size: 70px;
            font-weight: bold;
        }
        .hero p {
            font-size: 18px;
        }
        /* Product cards */
        .card {
            border: none;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.1);
            transition: transform 0.2s ease;
        }
        .card:hover {
            transform: translateY(-5px);
        }
        .card img {
            border-top-left-radius: 12px;
            border-top-right-radius: 12px;
            height: 200px;
            object-fit: cover;
            width: 100%;
        }
        .card-body h5 {
            font-weight: bold;
            color: #333;
        }
        .btn-primary {
            background:grey;
            color:white;
            border: none;
        }
        .btn-primary:hover {
            background:grey;
            color:black;
        }

        .footer {
        width: 100%;
        padding: 8px 0;
        font-size: 14px;
        font-weight: bold;
        margin-top:50px;
        color: #000;
        background: transparent; /* no background */
        position: relative; /* stays at bottom of content */
    }
    </style>
</head>
<body>

<!-- Navbar -->
<nav class="navbar navbar-custom navbar-expand-lg">
    <div class="container-fluid">
        <a class="navbar-brand" href="#">MyShop</a>
        <ul class="nav navbar-nav navbar-right">
            <li>
                <a href="/user/cart" class="btn btn-light navbar-btn">View Cart</a>
            </li>
            <li>
                <a href="/logout" class="btn btn-light navbar-btn">Logout</a>
            </li>
        </ul>
    </div>
</nav>

<!-- Hero Section -->
<div class="hero">
    <h1>Welcome</h1>
    <p>Your one-stop shop for amazing products</p>
</div>

<!-- Products Section -->
<div class="container mt-4">
    <div class="row">
        <div class="col-md-4 mb-4" th:each="product : ${products}">
            <div class="card">
                <img th:src="@{'/images/' + ${product.imageName}}" alt="Product">
                <div class="card-body">
                    <h5 class="card-title" th:text="${product.name}"></h5>
                    <p class="card-text" th:text="${product.description}"></p>
                    <p><strong>₹</strong> <span th:text="${product.price}"></span></p>

                    <!-- Stock logic -->
                    <th:block th:with="reservedMap=${session.reservedStock},
                                       reservedQty=${reservedMap != null and reservedMap[product.id] != null ? reservedMap[product.id] : 0},
                                       availableStock=${product.stock - reservedQty}">

                        <p class="card-text text-muted">
                            Available: <span th:text="${availableStock}"></span>
                        </p>

                        <!-- If available stock > 0 -->
                        <a th:if="${availableStock > 0}"
                           th:href="@{'/user/add-to-cart/' + ${product.id}}"
                           class="btn btn-primary btn-sm btn-block">
                            Add to Cart
                        </a>

                        <!-- If out of stock -->
                        <button th:if="${availableStock <= 0}" class="btn btn-secondary btn-sm btn-block" disabled>
                            Out of Stock
                        </button>
                    </th:block>
                </div>
            </div>
        </div>
    </div>
</div>

<footer class="footer text-center">
    <p>© My Shop 2025</p>
</footer>

</body>
</html>
